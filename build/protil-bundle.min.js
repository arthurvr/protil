(function(t){var e=i.immediateFn||typeof setImmediate==="function"&&setImmediate||function(t){setTimeout(t,1)};function n(t,e){return function(){t.apply(e,arguments)}}var r=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};function i(t){if(typeof this!=="object")throw new TypeError("Promises must be constructed via new");if(typeof t!=="function")throw new TypeError("not a function");this._state=null;this._value=null;this._deferreds=[];l(t,n(u,this),n(s,this))}function o(t){var n=this;if(this._state===null){this._deferreds.push(t);return}e(function(){var e=n._state?t.onFulfilled:t.onRejected;if(e===null){(n._state?t.resolve:t.reject)(n._value);return}var r;try{r=e(n._value)}catch(i){t.reject(i);return}t.resolve(r)})}function u(t){try{if(t===this)throw new TypeError("A promise cannot be resolved with itself.");if(t&&(typeof t==="object"||typeof t==="function")){var e=t.then;if(typeof e==="function"){l(n(e,t),n(u,this),n(s,this));return}}this._state=true;this._value=t;f.call(this)}catch(r){s.call(this,r)}}function s(t){this._state=false;this._value=t;f.call(this)}function f(){for(var t=0,e=this._deferreds.length;t<e;t++){o.call(this,this._deferreds[t])}this._deferreds=null}function c(t,e,n,r){this.onFulfilled=typeof t==="function"?t:null;this.onRejected=typeof e==="function"?e:null;this.resolve=n;this.reject=r}function l(t,e,n){var r=false;try{t(function(t){if(r)return;r=true;e(t)},function(t){if(r)return;r=true;n(t)})}catch(i){if(r)return;r=true;n(i)}}i.prototype["catch"]=function(t){return this.then(null,t)};i.prototype.then=function(t,e){var n=this;return new i(function(r,i){o.call(n,new c(t,e,r,i))})};i.all=function(){var t=Array.prototype.slice.call(arguments.length===1&&r(arguments[0])?arguments[0]:arguments);return new i(function(e,n){if(t.length===0)return e([]);var r=t.length;function i(o,u){try{if(u&&(typeof u==="object"||typeof u==="function")){var s=u.then;if(typeof s==="function"){s.call(u,function(t){i(o,t)},n);return}}t[o]=u;if(--r===0){e(t)}}catch(f){n(f)}}for(var o=0;o<t.length;o++){i(o,t[o])}})};i.resolve=function(t){if(t&&typeof t==="object"&&t.constructor===i){return t}return new i(function(e){e(t)})};i.reject=function(t){return new i(function(e,n){n(t)})};i.race=function(t){return new i(function(e,n){for(var r=0,i=t.length;r<i;r++){t[r].then(e,n)}})};if(typeof module!=="undefined"&&module.exports){module.exports=i}else if(!t.Promise){t.Promise=i}})(this);!function(t,e){if(typeof exports==="object"){var n=n||require("../lib/Promise");global.Promise=n;module.exports=e(global)}else if(t.window){t.protil=e(t)}}(this,function(t){"use strict";var e={};var n=t.Promise;var r=undefined;if(t.protil)r=t.protil;e.noConflict=function(){global.protil=r;return this};e.setPromises=function(t){if(!this._checkPromises(t)){throw new Error("protil Promises must provide ES6 Promise Constructor")}else{n=t}};e.isValidPromise=function(t){return typeof t.then().then==="function"&&t.then()instanceof Object.getPrototypeOf(t).constructor};e._checkPromises=function(t){var e=t||n;var r=undefined;try{r=new e(function(t,e){return true?t(true):e(false)})}catch(i){return false}return this.isValidPromise(r)};return e});